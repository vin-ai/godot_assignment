{% extends "partners/base.html" %} {% block content %}
<form class="needs-validation" id="partner_form" action="{% url 'api:partner-list' %}">
  {{partner_form.as_p}}
  <div class="text-center">
    <button class="btn btn-lg btn-primary" type="submit">
      Add New Partner
    </button>
  </div>
</form>
{% endblock %} {% block extra_footer_tags %}
<script type="text/javascript">
const getFormJSON = (form) => {
  const data = new FormData(form);
  return Array.from(data.keys()).reduce((result, key) => {
    result[key] = data.get(key);
    return result;
  }, {});
};

  document.addEventListener("DOMContentLoaded", (e) => {
    console.log("Partners Loading...");
    const form = document.querySelector("#partner_form");
    form.addEventListener(
      "submit",
      (event) => {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();

          fetch(form.getAttribute('action'), {
            method: 'POST',
            cache: 'no-cache',
            headers: {
              'Content-Type': 'application/json'
              // 'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: JSON.stringify(getFormJSON(form))
          })
            .then((response) => response.json())
            .then((data) => {
              console.log(data);
            })
            .catch((reason) => {
              console.log(reason);
            });
        }

        form.classList.add("was-validated");
      },
      false
    );
  });
</script>
{% endblock %}
